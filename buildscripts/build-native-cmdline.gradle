apply plugin: 'konan'
apply from: "buildscripts/codegen.gradle"

konanInterop {
    C {
        defFile 'deps/C.def'
    }
    Math {
        defFile 'deps/Math.def'
    }
}

konanArtifacts {
    Golem {
        inputFiles project.fileTree('backend-all-purekt/src'),
                project.fileTree('backend-all-purekt/srcgen'),
                project.fileTree('golem-core/src'), 
                project.fileTree('golem-core/srcnative'), 
                project.fileTree('golem-core/external'),
                'examples/native/main.kt'
        useInterop 'C'
        useInterop 'Math'
        linkerOpts "-S"
        enableOptimization()
    }
}

build.dependsOn(":codegen")
build {
    doLast {
        copy {
            from compileKonanGolem.artifactPath
            into projectDir.canonicalPath
        }
    }
}

buildscript {
    ext.kotlin_version='1.1.2'

    repositories {
        mavenCentral()
        jcenter()
        maven {
            url  "https://dl.bintray.com/jetbrains/kotlin-native-dependencies"
        }
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-native-gradle-plugin:0.1"
    }
}
