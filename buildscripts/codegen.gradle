task codegen {
    doLast {
        ['Double', 'Float', 'Int'].forEach { dtype ->
            copy {
                from 'core/templates'
                into 'core/srcgen/koma.matrix.default'
                include 'DefaultMatrix*.kt'
                rename { dtype + it }

                expand(epow: getEPow(dtype),
                        dtype: dtype)
            }
            copy {
                from 'core/templates'
                into 'core/srcgen/koma.ndarray.default'
                include 'DefaultNDArray*.kt'
                rename { dtype + it }
                expand(dtype: dtype)
            }
            copy {
                from 'core/templates'
                into 'core/srcgen/koma.matrix'
                include 'Matrix.kt'
                rename { dtype + it }
                expand(dtype: dtype)
            }
        }
    }

}
def getEPow(dtype) {
    if (dtype != 'Int')
        return """
    override fun epow(other: ${dtype}): ${dtype}Matrix 
            = this.mapMatIndexed { row, col, ele -> Math.pow(ele.toDouble(), other.toDouble()).to${dtype}() }
"""
    else
        return ""

}